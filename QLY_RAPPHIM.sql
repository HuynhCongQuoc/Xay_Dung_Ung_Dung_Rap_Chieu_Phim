CREATE DATABASE QLY_RAPPHIM
USE QLY_RAPPHIM
-- TẠO BẢNG --
CREATE TABLE PHONGBAN
(
	MAPB CHAR(6) PRIMARY KEY NOT NULL,
	TENPB NVARCHAR(20),
	DIADIEMPB NVARCHAR(30)
)
CREATE TABLE CONGVIEC
(
	MACV CHAR(6) PRIMARY KEY,
	TENCV NVARCHAR(30),
	DIADIEMCV NVARCHAR(30),
	MANV CHAR(6),
	MAPB CHAR(6),
	THOIGIANBD DATE
)
CREATE TABLE PHANCONG
(
	MACV CHAR(6),
	MANV CHAR(6),
	CONSTRAINT PK_PC_NV PRIMARY KEY (MACV, MANV)
)
CREATE TABLE THENHANVIEN
(
	MATHE CHAR(6) PRIMARY KEY,
	MANV CHAR(6),
	NGAYCAP DATE
)
CREATE TABLE PHONGBANVE
(
	MAPBV CHAR(6) PRIMARY KEY,
	HINHTHUC NVARCHAR(50),
	DIADIEMPBV NVARCHAR(100)
)
CREATE TABLE NHANVIEN
(
	MANV CHAR(6) PRIMARY KEY,
	HOTENNV NVARCHAR(30),
	NGAYSINH DATE,
	PHAI NVARCHAR(6),
	LUONG INT,
	DIACHI NVARCHAR(30),
	MAPBV CHAR(6)
)
CREATE TABLE PHONGCHIEU
(
	MAPC CHAR(6) PRIMARY KEY,
	TENPC NVARCHAR(30),
	DIADIEMPC NVARCHAR(40)
)
CREATE TABLE LICHCHIEU
(
	MALC CHAR(6) PRIMARY KEY,
	TENPHIM NVARCHAR(40),
	NGAYCHIEU DATE,
	GIOCHIEU DATETIME,
	MAPC CHAR(6)
)
CREATE TABLE KHACHHANG
(
	MAVE CHAR(6) PRIMARY KEY,
	DAYGHE CHAR(6),
	SOGHE INT,
	GIAVE INT,
	TENKH NVARCHAR(40),
	MALC CHAR(6)
)
CREATE TABLE CHITIETDATHUY
(
	MAVE CHAR(6),
	NGAYDAT DATE,
	NGAYHUY DATE,
	MAPBV CHAR(6),
	GHICHU NVARCHAR(50),
	CONSTRAINT PK_CTDH_PBV PRIMARY KEY (MAVE, MAPBV))
-- KHÓA NGOẠI --
ALTER TABLE CONGVIEC
ADD CONSTRAINT FK_CV_PB FOREIGN KEY(MAPB) REFERENCES PHONGBAN(MAPB)

ALTER TABLE PHANCONG
ADD CONSTRAINT FK_PC_CV FOREIGN KEY(MACV) REFERENCES CONGVIEC(MACV)
ALTER TABLE PHANCONG
ADD CONSTRAINT FK_PC_NV	FOREIGN KEY(MANV) REFERENCES NHANVIEN(MANV)

ALTER TABLE NHANVIEN
ADD CONSTRAINT FK_NV_PBV FOREIGN KEY(MAPBV) REFERENCES PHONGBANVE(MAPBV)

ALTER TABLE THENHANVIEN
ADD CONSTRAINT FK_TNV_NV FOREIGN KEY(MANV) REFERENCES NHANVIEN(MANV)

ALTER TABLE LICHCHIEU
ADD CONSTRAINT FK_LC_PC FOREIGN KEY(MAPC) REFERENCES PHONGCHIEU(MAPC)

ALTER TABLE KHACHHANG
ADD CONSTRAINT FK_KH_LC FOREIGN KEY(MALC) REFERENCES LICHCHIEU(MALC)

ALTER TABLE CHITIETDATHUY
ADD CONSTRAINT FK_CTDH_KH FOREIGN KEY(MAVE) REFERENCES KHACHHANG(MAVE)
ALTER TABLE CHITIETDATHUY
ADD CONSTRAINT FK_CTDH_PBV FOREIGN KEY(MAPBV) REFERENCES PHONGBANVE(MAPBV)
-- DỮ LIỆU
SET DATEFORMAT DMY
INSERT INTO PHONGBAN VALUES
('PB01',N'Nhân sự',N'Tầng 7 nhà A'),
('PB02',N'Quản lý',	N'Tầng 7 nhà A'),
('PB03',N'Tài vụ',N'Tầng 10 nhà A'),
('PB04',N'Kế hoạch', N'Tầng 9 nhà A')
INSERT INTO CONGVIEC VALUES
('CV01',N'Bán thức ăn(nước uống)',N'Tầng 8 nhà A','NV01','PB01','20/2/2002'),
('CV02',N'Kiểm soát vé',N'Tầng 8 nhà A','NV02','PB02','20/2/2002'),
('CV03',N'Tạp vụ',N'Tầng 7,8,9,10 nhà A','NV03','PB03','20/2/2002'),
('CV04',N'Bảo vệ',N'Tầng hầm nhà A','NV04','PB04','20/2/2002'),
('CV05',N'Lập kế hoạch',N'Tầng 9 nhà A','NV05','PB04','20/2/2002')
INSERT INTO PHONGBANVE VALUES
('BV01',N'Trực tiếp/Trực tuyến',N'271 Nguyễn Trãi, P. Nguyễn Cư Trinh, Q.1, Tp. Hồ Chí Minh'),
('BV02',N'Trực tiếp/Trực tuyến',N'135 Hai Bà Trưng, P. Bến Nghé, Q.1, Tp. Hồ Chí Minh'),
('BV03',N'Trực tiếp/Trực tuyến',N'718 Kinh Dương Vương, Q.6, Tp. Hồ Chí Minh'),
('BV04',N'Trực tiếp/Trực tuyến',N'Lầu 3, CoopMart Foodcosa, 304A Quang Trung, P.11, Q. Gò Vấp, Tp. Hồ Chí Minh'),
('BV05',N'Trực tiếp/Trực tuyến',N'Tầng 10, CT Plaza, 60A Trường Sơn, P.2, Q. Tân Bình, Tp. Hồ Chí Minh'),
('BV06',N'Trực tiếp/Trực tuyến',N'Tầng 7, Hùng Vương Plaza, 126 Hùng Vương, Q.5, Tp. Hồ Chí Minh'),
('BV07',N'Trực tiếp/Trực tuyến',N'Lầu 5, Crescent Mall Đại lộ Nguyễn Văn Linh, Phú Mỹ Hưng, Q.7 Tp. Hồ Chí Minh'),
('BV08',N'Trực tiếp/Trực tuyến',N'Lầu 3, Pandora City 1/1 Trường Chinh, Q. Tân Phú, Tp. Hồ Chí Minh'),
('BV09',N'Trực tiếp/Trực tuyến',N'Lầu 3, Aeon Mall 30 Bờ Bao Tân Thắng, P. Sơn Kỳ, Q. Tân Phú, Tp. Hồ Chí Minh'),
('BV10',N'Trực tiếp/Trực tuyến',N'Tầng 3, TTTM Aeo Bình Tân, P. Bình Trị Đông B, quận Bình Tân, TP. Hồ Chí Minh')
INSERT INTO NHANVIEN VALUES
('NV01',N'Nguyễn Văn Nam','12/7/1988','Nam',5000000,N'Tây Ninh','BV01'),
('NV02',N'Lê Thị Hạnh',	'21/2/1998',N'Nữ',6500000,N'Hà Nội','BV02'),
('NV03',N'Phạm Văn Hưng','3/2/1988','Nam',6000000,N'Bình Thuận','BV03'),
('NV04',N'Nguyễn Thị Vân','1/6/1997',N'Nữ',8000000,N'Thanh Hóa','BV04'),
('NV05',N'Nguyễn Tố Vân','24/4/1866',N'Nữ',7500000,N'Hà Nội','BV05'),
('NV06',N'Trần Minh Tú','5/12/2002','Nam',4500000,N'Long An','BV06'),
('NV07',N'Chau Riêm','20/7/2002','Nam',4000000,N'Trà Vinh','BV07'),
('NV08',N'Phạm Thị Nga','12/3/2003',N'Nữ',3500000,N'Quãng Ngãi','BV08'),
('NV09',N'Lê Huy','1/1/2003','Nam',3500000,'TP HCM','BV09'),
('NV10',N'Phan Quỳnh Anh','20/2/1866',N'Nữ',10000000,N'Trà Vinh','BV10')
INSERT INTO PHANCONG VALUES
('CV01','NV01'),
('CV02','NV02'),
('CV03','NV03'),
('CV04','NV04'),
('CV05','NV04'),
('CV05','NV06')
INSERT INTO THENHANVIEN VALUES
('T001','NV01','2/1/2013'),
('T002','NV02','1/2/2014'),
('T003','NV05','1/2/2013'),
('T004','NV03','3/2/2018'),
('T005','NV04','6/1/2017')
INSERT INTO PHONGCHIEU VALUES
('PC01','PHONG 1',N'Tầng 1 nhà A'),
('PC02','PHONG 2',N'Tầng 2 nhà A'),
('PC03','PHONG 3',	N'Tầng 3 nhà B'),
('PC04','PHONG 4',	N'Tầng 4 nhà B')
INSERT INTO LICHCHIEU VALUES
('LC01',N'Lật mặt','22/5/2022','13:30:00','PC01'),
('LC02',N'Bố già',	'21/5/2022','21:00:00','PC02'),
('LC03',N'Kẻ thứ 3','22/5/2022','15:45:00','PC02'),
('LC04',N'Hậu duệ Tình người duyên ma','20/5/2022','19:15:00','PC01'),
('LC05',N'Bẫy ngọt ngào','22/5/2022','17:30:00','PC03'),
('LC06',N'Gái già lắm chiêu','22/5/2022','9:00:00',	'PC03'),
('LC07',N'Nghề siêu dễ','6/10/2022','15:00:00','PC04')
INSERT INTO KHACHHANG VALUES
('VE01','A',8,80000,N'Trần Văn An',	'LC01'),
('VE02','E',5,60000,N'Lê Bảo Nhi','LC02'),
('VE03','F',2,120000,N'Lâm Hùng','LC03'),
('VE04','B',9,120000,N'Phạm Bảo Anh','LC04'),
('VE05','C',3,95000,N'Lê Văn Huy','LC05'),
('VE06','H',2,135000,N'Phạm Hoàng','LC06'),
('VE07','D',6,150000,N'Lê Bảo Kha','LC07')
INSERT INTO CHITIETDATHUY VALUES
('VE01','20/2/2022','12/3/2022','BV01',N'Có việc bận'),
('VE02','22/2/2022',null,'BV02',null),
('VE03','20/2/2022','24/4/2022','BV03',N'Có việc bận'),
('VE04','22/2/2022',null,'BV04',null),
('VE05','20/2/2022','16/6/2022','BV05',N'Có việc bận'),
('VE06','22/2/2022',null,'BV06',null),
('VE07','20/2/2022',null,'BV07',null)
-- XỬ LÝ YÊU CẦU --
select KH.MAVE, TENKH, NGAYDAT, NGAYHUY, GHICHU, PBV.DIADIEMPBV
from KHACHHANG KH, CHITIETDATHUY CTDH, PHONGBANVE PBV 
where KH.MAVE = CTDH.MAVE AND PBV.MAPBV = CTDH.MAPBV AND NGAYDAT = '2022-2-20'
-- TRUY VẤN --
SELECT * FROM PHONGBAN
SELECT * FROM CONGVIEC
SELECT * FROM NHANVIEN
SELECT * FROM PHANCONG
SELECT * FROM THENHANVIEN
SELECT * FROM PHONGBANVE
SELECT * FROM PHONGCHIEU
SELECT * FROM LICHCHIEU
SELECT * FROM KHACHHANG
SELECT * FROM CHITIETDATHUY
-- XÓA BẢNG -- 
DROP TABLE PHONGBAN
DROP TABLE CONGVIEC
DROP TABLE NHANVIEN
DROP TABLE PHANCONG
DROP TABLE THENHANVIEN
DROP TABLE PHONGBANVE
DROP TABLE PHONGCHIEU
DROP TABLE LICHCHIEU
DROP TABLE KHACHHANG
DROP TABLE CHITIETDATHUY

